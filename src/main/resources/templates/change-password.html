<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Đổi mật khẩu</title>
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/fontawesome/css/all.min.css">
  <script src="/js/jquery/lib/jquery.js"></script>
  <script src="/js/jquery/dist/jquery.validate.min.js"></script>
  <script src="/js/alert.js"></script>
</head>
<body>
<div class="change-pwd-container">
  <div th:if="${failed}" role="alert" th:text="${failed}" class="alert alert-danger alert-message"></div>

  <div class="change-pwd-content d-flex flex-column justify-content-center align-items-center w-100 h-100">
    <div class="change-pwd-card d-flex flex-column justify-content-center align-items-center">
      <h3 class="mb-5">Đổi mật khẩu</h3>
      <form th:action="@{doing-change}" th:object="${account}" method="post"
      class="change-pwd-form w-100 px-5" id="change-password-form">
        <input th:field="*{id}" type="hidden">
        <div class="form-outline form-white mb-4 position-relative
        d-flex flex-column align-items-center">
          <label class="form-label" for="password-old"></label>
          <input type="password" class="form-control form-control-lg" id="password-old"
                 name="password" placeholder="Nhập mật khẩu cũ(*)"
                 th:field="*{password}" required/>
          <i class="fa-solid fa-eye-slash position-absolute mt-2" id="toggle-password1"></i>
          <span th:errorclass="error" th:if="${#fields.hasErrors('password')}"
                th:errors="*{password}"></span>
        </div>

        <div class="form-outline form-white mb-4 position-relative
        d-flex flex-column align-items-center">
          <label class="form-label" for="password-new"></label>
          <input type="password" class="form-control form-control-lg" id="password-new"
                 name="passwordNew" placeholder="Nhập mật mới(*)" required/>
          <i class="fa-solid fa-eye-slash position-absolute mt-2" id="toggle-password2"></i>
        </div>

        <div class="form-outline form-white mb-4 position-relative
         d-flex flex-column align-items-center">
          <label class="form-label" for="password-new-again"></label>
          <input type="password" class="form-control form-control-lg" id="password-new-again"
                 name="passwordNewAgain" placeholder="Nhập lại mật khẩu mới(*)" required/>
          <i class="fa-solid fa-eye-slash position-absolute mt-2" id="toggle-password3"></i>
        </div>

        <button class="btn btn-outline-dark btn-lg px-5 mt-4 mx-4"
                type="submit">Xác nhận</button>
        <a th:if="${#authentication.name.startsWith('ma')}"
           th:href="@{/admin}" onclick="return confirm('Bạn có chắc muốn hủy?')"
           class="btn btn-outline-warning btn-lg px-5 mt-4">Hủy</a>
        <a th:if="${#authentication.name.startsWith('te') || #authentication.name.startsWith('st')}"
           th:href="@{/}" onclick="return confirm('Bạn có chắc muốn hủy?')"
        class="btn btn-outline-warning btn-lg px-5 mt-4 text-dark mx-4">Hủy</a>
      </form>
    </div>
  </div>
</div>
<style>
  .error {
    color: red;
    float: left;
    margin-right: auto;
  }

  .change-pwd-container {
    width: 100vw;
    height: 100vh;
  }

  .change-pwd-card {
    width: 600px;
    height: 500px;
    border: darkgray solid;
  }

  #toggle-password1,
  #toggle-password2,
  #toggle-password3 {
    cursor: pointer;
    right: 20px;
    margin-top: 25px !important;
  }
</style>
<script type="text/javascript">
  // validate password
  jQuery.validator.addMethod("validatePassword", function (value, element) {
    return this.optional(element) || /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,32}$/.test(value);
  }, "Mật khẩu phải chứa 1 chữ hoa, 1 chữ thường, 1 chữ số và 1 ký tự đặc biệt!");

  // jQuery.validator.addMethod("comparePassword" function())

  // validate for input
  $().ready(function() {
    $("#change-password-form").validate({
      onfocusout: false,
      onkeyup: false,
      onclick: false,
      rules: {
        "password-old": {
          required: true,
          minlength: 8
        },
        "password-new": {
          required: true,
          minlength: 8,
          validatePassword: true
        },
        "password-new-again": {
          required: true,
          minlength: 8,
          validatePassword: true
        }
      },
      messages: {
        "password-old": {
          required: "Mật khẩu cũ không được để trống!",
          minlength: "Mật khẩu cũ phải nhiều hơn 8 ký tự!"
        },
        "password-new": {
          required: "Mật khẩu mới không được để trống!",
          minlength: "Mật khẩu mới phải nhiều hơn 8 ký tự!"
        },
        "password-new-again": {
          required: "Mật khẩu mới nhập lại không được để trống!",
          minlength: "Mật khẩu mới nhập lại phải nhiều hơn 8 ký tự!"
        }
      },
      highlight: function(element) {
        $(element).css("border-color", "red");
      },

      unhighlight: function(element) {
        $(element).css("border-color", "");
      },
    });
  });

  // password toggle
  const togglePassword1 = document.querySelector('#toggle-password1');
  const togglePassword2 = document.querySelector('#toggle-password2');
  const togglePassword3 = document.querySelector('#toggle-password3');
  const password = document.querySelector('#password-old');
  const passwordNew = document.querySelector('#password-new');
  const passwordNewAgain = document.querySelector('#password-new-again');

  togglePassword1.addEventListener('click', function (e) {
    const type = password.getAttribute('type') === 'password' ? 'text' : 'password';

    if (this.classList.contains("fa-eye")) {
      this.classList.replace("fa-eye", "fa-eye-slash")
    } else {
      this.classList.replace("fa-eye-slash" ,"fa-eye")
    }
    password.setAttribute('type', type);
  });

  togglePassword2.addEventListener('click', function (e) {
    const type = passwordNew.getAttribute('type') === 'password' ? 'text' : 'password';

    if (this.classList.contains("fa-eye")) {
      this.classList.replace("fa-eye", "fa-eye-slash")
    } else {
      this.classList.replace("fa-eye-slash" ,"fa-eye")
    }
    passwordNew.setAttribute('type', type);
  });

  togglePassword3.addEventListener('click', function (e) {
    const type = passwordNewAgain.getAttribute('type') === 'password' ? 'text' : 'password';

    if (this.classList.contains("fa-eye")) {
      this.classList.replace("fa-eye", "fa-eye-slash")
    } else {
      this.classList.replace("fa-eye-slash" ,"fa-eye")
    }
    passwordNewAgain.setAttribute('type', type);
  });
</script>
</body>
</html>